{% extends "layout.html" %}

<!DOCTYPE html>

{% block title %}
    Register
{% endblock %}
    <head>

    </head>
{% block main %}
    <body>
        <div>
            <p><h3 align="center" color="#ff0000">Register for a brand new VibeCheck account here!</h3></p>
        </div>

        <form action="/register" method="post" class="needs-validation" novalidate>
            <div class="form-group">
                <p align="left"><strong>Username</strong></p>
                <input type="text" class="form-control" id="username" placeholder="Username" onkeyup= "checks()" required>
                <div class="invalid-feedback" id="taken"> Provide a username </div>

            </div>
            <br>
            <div class="form-group">
                <p align="left"><strong>Password</strong><br>(Must be at least 8 characters long)</p>

                <input class="form-control" name="password" placeholder="Password" type="password" required>
                <div class="invalid-feedback"></div>
            </div>
            </br>
            <br>
            <div class="form-group">
                <p align="left"><strong>Confirm password</strong></p>

                <input class="form-control" name="confirmation" placeholder="Repeat password" type="password" required>
                <div class="invalid-feedback"></div>
            </div>
            </br>
            <div align="center">
                <button class="btn btn-primary" type="submit">Register!</button>
            </div>
            <div>
               Already have an account? <br><a href= "login">Log in here!</a>
            </div>
        </form>

    </body>
<script>


    let users_name = document.getElementById("username");
    let alert_user = document.getElementById("taken");
    function  checks() {
        $.get("/check?username="+ users_name.value, function (checked){
            if (checked == false) {
                alert_user.innerHTML = "Username not available";
                users_name.setAttribute("class", "form-control is-invalid");
            }
            else {
                alert_user.innerHTML = "Username available";
                users_name.setAttribute("class", "form-control");
            }
        });
    }
    // https://getbootstrap.com/docs/4.1/components/forms/#validation
    (function() {
      'use strict';
      window.addEventListener('load', function() {
        // Fetch all the forms we want to apply custom Bootstrap validation styles to
        var forms = document.getElementsByClassName('needs-validation');
        // Loop over them and prevent submission
        var validation = Array.prototype.filter.call(forms, function(form) {
          form.addEventListener('submit', function(event) {
            if (form.checkValidity() === false || users_name.getAttribute("class") == "form-control is-invalid") {
              event.preventDefault();
              event.stopPropagation();
            }
            form.classList.add('was-validated');
          }, false);
        });
      }, false);
    })();

</script>
{% endblock %}